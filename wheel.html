<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wheel of Fortune</title>
  <style>
    html, body { height: 100%; margin: 0; background: #121212; color: #eaeaea; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .wrap { display: grid; place-items: center; height: 100%; gap: 16px; }
    #c { background: #1a1a1a; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    .controls { display: flex; gap: 12px; align-items: center; }
    button { background: #ffd233; color: #222; border: 0; padding: 10px 16px; border-radius: 8px; font-weight: 700; cursor: pointer; }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
    .label { opacity: 0.85; }
  </style>
</head>
<body>
  <div class="wrap">
    <canvas id="c" width="560" height="620"></canvas>
    <div class="controls">
      <button id="spinBtn">Spin</button>
      <button id="resetBtn">Reset</button>
      <span class="label" id="result">Result: —</span>
    </div>
  </div>

  <script>
    (function(){
      const TAU = Math.PI * 2;
      const canvas = document.getElementById('c');
      const ctx = canvas.getContext('2d');
      const W = canvas.width, H = canvas.height;
      const cx = W/2, cy = H/2 - 10;
      const outerR = 220;
      const innerR = 40;
      const colors = ['#ff4d4d','#29cc7a','#4d7dff','#ffd233'];

      let labels = Array.from({length: 12}, (_, i) => `S${i+1}`);
      let rotation = 0; // radians
      let anim = null; // { t0, d, start, end }
      let winnerIndex = null;

      function easeOutQuint(t){ return 1 - Math.pow(1-t, 5); }

      function draw(){
        ctx.clearRect(0,0,W,H);
        ctx.save();
        ctx.translate(cx, cy);
        ctx.rotate(rotation);

        const n = labels.length;
        const segAngle = TAU / Math.max(1, n);

        // Rim
        ctx.beginPath();
        ctx.arc(0,0, outerR+8, 0, TAU);
        ctx.fillStyle = '#caa96c'; ctx.fill();
        ctx.lineWidth = 6; ctx.strokeStyle = '#7b6331'; ctx.stroke();

        for (let i=0;i<n;i++){
          const a0 = i * segAngle - TAU/4;
          const a1 = (i+1) * segAngle - TAU/4;

          // wedge
          ctx.beginPath();
          ctx.arc(0,0, innerR, a0, a1);
          ctx.arc(0,0, outerR, a1, a0, true);
          ctx.closePath();
          ctx.fillStyle = colors[i % colors.length]; ctx.fill();
          ctx.lineWidth = 2; ctx.strokeStyle = '#fff'; ctx.stroke();

          // label
          const mid = (a0 + a1)/2;
          const rx = Math.cos(mid) * (innerR + outerR)/2;
          const ry = Math.sin(mid) * (innerR + outerR)/2;
          ctx.save();
          ctx.translate(rx, ry);
          ctx.rotate(mid + Math.PI/2);
          ctx.fillStyle = '#111';
          ctx.font = 'bold 18px system-ui, sans-serif';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          ctx.fillText(labels[i], 0, 0);
          ctx.restore();
        }

        // Hub
        ctx.beginPath();
        ctx.arc(0,0, innerR-8, 0, TAU);
        ctx.fillStyle = '#e74c3c'; ctx.fill();
        ctx.lineWidth = 6; ctx.strokeStyle = '#a22619'; ctx.stroke();

        ctx.restore();

        // Pointer (fixed at top)
        ctx.beginPath();
        const tipX = cx, tipY = cy - outerR - 6;
        ctx.moveTo(tipX - 18, tipY - 24);
        ctx.lineTo(tipX + 18, tipY - 24);
        ctx.lineTo(tipX, tipY);
        ctx.closePath();
        ctx.fillStyle = '#ffd233'; ctx.fill();
        ctx.lineWidth = 4; ctx.strokeStyle = '#7b6331'; ctx.stroke();

        // Plaque text
        const resEl = document.getElementById('result');
        if (winnerIndex == null) resEl.textContent = 'Result: —';
      }

      function spin(){
        if (anim || labels.length === 0) return;
        const n = labels.length;
        const segAngle = TAU / n;
        // random winner among remaining labels
        const targetIndex = Math.floor(Math.random() * n);
        const centerAngle = -TAU/4 + (targetIndex + 0.5) * segAngle; // wheel-local
        const desiredMod = -centerAngle; // rotation so mid sits under pointer
        const extraTurns = 4 + Math.random()*2; // 4..6 turns
        const baseEnd = rotation + extraTurns * TAU;
        const delta = normalize(desiredMod - baseEnd);
        const end = baseEnd + delta;

        const d = 4200; // ms
        const t0 = performance.now();
        const start = rotation;
        winnerIndex = null;
        anim = { t0, d, start, end, targetIndex };

        requestAnimationFrame(step);
      }

      function step(now){
        if (!anim) return;
        const t = Math.min(1, (now - anim.t0) / anim.d);
        const k = easeOutQuint(t);
        rotation = anim.start + (anim.end - anim.start) * k;
        draw();
        if (t < 1) {
          requestAnimationFrame(step);
        } else {
          // settle
          rotation = anim.end;
          winnerIndex = anim.targetIndex;
          const label = labels[winnerIndex];
          document.getElementById('result').textContent = `Result: ${label}`;
          anim = null;
          // Remove the winning slice and keep rotation congruent
          labels.splice(winnerIndex, 1);
          // Normalize rotation to [0, TAU)
          rotation = ((rotation % TAU) + TAU) % TAU;
          draw();
        }
      }

      function normalize(a){
        a = (a % TAU + TAU) % TAU; // 0..TAU
        return a; // always forward
      }

      function reset(){
        labels = Array.from({length: 12}, (_, i) => `S${i+1}`);
        rotation = 0;
        winnerIndex = null;
        anim = null;
        draw();
      }

      document.getElementById('spinBtn').addEventListener('click', spin);
      document.getElementById('resetBtn').addEventListener('click', reset);

      draw();
    })();
  </script>
</body>
</html>
